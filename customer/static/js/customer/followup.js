layui.use(["element","form","layedit","laytpl"],function(){var a=layui.form,f=layui.layer,e=layui.layedit,d=layui.jquery,h=layui.laytpl;var c=[];var g=e.build("content",{tool:["strong","italic","underline","del","addhr","|","fontFomatt","colorpicker","face","|","left","center","right",,"|","fullScreen"]});function b(l){var j=new RegExp("(^|&)"+l+"=([^&]*)(&|$)","i");var k=window.location.search.substr(1).match(j);if(k!=null){return unescape(k[2])}return null}function i(){d(".button").click(function(){id=d(this).attr("followid");d.ajax({url:"/api/v1.0/follow/"+id,type:"delete",dataType:"json",headers:{"X-CSRFToken":getCookie("csrf_token")},success:function(m){f.msg(m.errmsg);for(var l=0;l<c.length;l++){if(c[l].id==id){c.splice(l,1);var k=demo.innerHTML,j=document.getElementById("view");h(k).render(c,function(n){j.innerHTML=n});i();return}}}})})}a.on("submit(demo1)",function(j){j.field.content=e.getContent(g);d.ajax({url:"/api/v1.0/follow/"+b("id"),type:"post",data:JSON.stringify(j.field),async:false,contentType:"application/json",dataType:"json",success:function(m){f.msg(m.errmsg);e.setContent(g,"",false);c.unshift({id:m.data.id,date:m.data.date,status:m.data.status,content:m.data.content});var l=demo.innerHTML,k=document.getElementById("view");data=c;h(l).render(c,function(n){k.innerHTML=n});i();return false}});return false});d(document).ready(function(){d.ajax({url:"/api/v1.0/follow/"+b("id"),type:"get",async:false,dataType:"json",success:function(l){if(l.errno==0){c=l.data;console.log(l);data=c;var k=demo.innerHTML,j=document.getElementById("view");h(k).render(c,function(m){j.innerHTML=m})}else{data=[]}}});i()})});