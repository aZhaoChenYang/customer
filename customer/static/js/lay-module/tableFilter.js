layui.define(["table","jquery","form","laydate"],function(b){var a="tableFilter",g=layui.jquery,e=layui.table,d=layui.form,c=layui.laydate;var f={"v":"1.0.0"};f.cache={};f.render=function(j){var m=g(j.elem||"#table"),o=m.attr("id")||"table_"+new Date().getTime(),l=j.filters||[],k=j.parent||"body",n=j.mode||"local";j.done=j.done||function(){};f.cache[o]={};var h=function(){if(n=="local"){var q=f.getShowTrIndex(m,o,l);if(q.length>0){var p=m.next().find(".layui-table-body tr");p.each(function(r,s){if(g.inArray(g(s).data("index"),q)!=-1){g(s).removeClass("layui-hide")}else{g(s).addClass("layui-hide")}})}else{m.next().find(".layui-table-body tr").removeClass("layui-hide")}f.fixAll(m);e.resize(o)}layui.each(l,function(w,v){var y=v.field,x=v.name||v.field,r=v.type||"input",A=v.data||[],s=v.url||"";var u=m.next().find('.layui-table-header th[data-field="'+y+'"]');var z=r=="input"?"layui-icon-search":"layui-icon-down";var t=g('<span class="layui-table-filter layui-inline"><i class="layui-icon '+z+'"></i></span>');u.find(".layui-table-cell").append(t);if(f.cache[o][x]){t.addClass("tableFilter-has")}else{t.removeClass("tableFilter-has")}t.on("click",function(H){H.stopPropagation();if(!v.data&&!s&&r!="input"){A=f.eachTds(m,y)}var F=g(this).offset().top+g(k).scrollTop()+g(this).outerHeight()+5+"px";var B=r=="date"?530:164;var C=g(this).offset().left-(g("body").outerWidth(true)-g(k).outerWidth(true))-B+"px";var G=g('<div class="layui-table-filter-view layui-anim layui-anim-fadein" style="top:'+F+";left:"+C+';"><div class="layui-table-filter-box"><form class="layui-form" lay-filter="table-filter-form"></form></div></div>');if(r=="input"){G.find("form").append('<input type="search" name="'+x+'" lay-verify="required" lay-verType="tips" placeholder="关键词" class="layui-input">')}if(r=="checkbox"){G.find("form").append("<ul></ul>");if(!s){layui.each(A,function(I,J){G.find("ul").append('<li><input type="checkbox" name="'+x+"["+J.key+']" value="'+J.key+'" title="'+J.value+'" lay-skin="primary"></li>')})}}if(r=="radio"){G.find("form").append('<ul class="radio"></ul>');if(!s){G.find("ul").append('<li><input type="radio" name="'+x+'" value="" title="All" checked></li>');layui.each(A,function(I,J){G.find("ul").append('<li><input type="radio" name="'+x+'" value="'+J.key+'" title="'+J.value+'"></li>')})}}if(r=="date"){G.find("form").append('<div class="layui-table-filter-date"></div>');G.find("form").append('<input type="text" name="'+x+'" lay-verify="required" lay-verType="tips" placeholder="请选择日期" class="layui-input">')}G.find("form").append('<button class="layui-btn layui-btn-normal layui-btn-sm" lay-submit lay-filter="tableFilter">确定</button>');G.find("form").append('<button type="button" class="layui-btn layui-btn-primary layui-btn-sm filter-del layui-btn-disabled" disabled>取消过滤</button>');g(this).hasClass("tableFilter-has")&&G.find(".filter-del").removeClass("layui-btn-disabled").removeAttr("disabled","disabled");g(k).append(G);d.val("table-filter-form",f.toLayuiFrom(o,x,r));d.render(null,"table-filter-form");if(r=="date"){c.render({elem:".layui-table-filter-date",range:true,type:"date",value:g(".layui-table-filter-date").next().val(),position:"static",showBottom:false,change:function(J,I,K){g(".layui-table-filter-date").next().val(J)}})}var D=G.find('form input[type="search"]');D.focus().select();if((r=="checkbox"||r=="radio")&&s){var E=G.find(".layui-table-filter-box ul");E.append('<div class="loading"><i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i></div>');g.getJSON(s+"?_t="+new Date().getTime(),function(J,I,K){E.empty();r=="radio"&&E.append('<li><input type="radio" name="'+x+'" value="" title="All" checked></li>');layui.each(J.data,function(L,M){r=="checkbox"&&E.append('<li><input type="checkbox" name="'+x+"["+M.key+']" value="'+M.key+'" title="'+M.value+'" lay-skin="primary"></li>');r=="radio"&&E.append('<li><input type="radio" name="'+x+'" value="'+M.key+'" title="'+M.value+'"></li>')});d.render(null,"table-filter-form");d.val("table-filter-form",f.toLayuiFrom(o,x,r))})}d.on("submit(tableFilter)",function(N){if(r=="checkbox"){var K=[];for(var L in N.field){K.push(N.field[L])}N.field[x]=K}f.cache[o][x]=N.field[x];if(f.cache[o][x].length>0){t.addClass("tableFilter-has")}else{t.removeClass("tableFilter-has")}if(n=="local"){var O=f.getShowTrIndex(m,o,l);if(O.length>0||N.field[x].length>0){var J=m.next().find(".layui-table-body tr");J.each(function(Q,R){if(g.inArray(g(R).data("index"),O)!=-1){g(R).removeClass("layui-hide")}else{g(R).addClass("layui-hide")}})}else{m.next().find(".layui-table-body tr").removeClass("layui-hide")}f.updataTotal(m);f.upNumbers(m);f.uncheck(m);e.resize(o)}else{if(n=="api"){var I={};for(var L in f.cache[o]){var M=L,P=f.cache[o][L];if(g.isArray(P)){I[M]=P.join(",")}else{I[M]=P}}e.reload(o,{"where":I})}}j.done(f.cache[o]);G.remove();return false});G.find(".layui-table-filter-box .filter-del").on("click",function(K){delete f.cache[o][x];t.removeClass("tableFilter-has");if(n=="local"){var L=f.getShowTrIndex(m,o,l);if(L.length>0){var I=m.next().find(".layui-table-body tr");I.each(function(M,N){if(g.inArray(g(N).data("index"),L)!=-1){g(N).removeClass("layui-hide")}else{g(N).addClass("layui-hide")}})}else{m.next().find(".layui-table-body tr").removeClass("layui-hide")}f.updataTotal(m);f.upNumbers(m);f.uncheck(m);e.resize(o)}else{if(n=="api"){var J={};J[x]="";e.reload(o,{"where":J})}}j.done(f.cache[o]);G.remove()});g(document).mouseup(function(J){var I=g(".layui-table-filter-view");if(!I.is(J.target)&&I.has(J.target).length===0){G.remove()}})})})};h();var i={"config":j,"reload":function(p){h();f.upNumbers(m)}};return i};f.eachTds=function(l,i){var j=[],h=[];var k=l.next().find('.layui-table-body td[data-field="'+i+'"]');k.each(function(m,n){j.push(g.trim(n.innerText))});j=f.tool.uniqueObjArray(j);layui.each(j,function(m,n){h.push({"key":n,"value":n})});return h};f.getShowTrIndex=function(k,i,h){var m=[];var j=f.cache[i];for(var q in j){var p=q,n=j[q];layui.each(h,function(r,s){if(p==s.name){p=s.field}});var l=k.next().find('.layui-table-body td[data-field="'+p+'"]');var o=[];l.each(function(r,w){if(g.isArray(n)){if(g.inArray(g.trim(w.innerText),n)>=0&&n&&n.length>0){o.push(g(w).parent().data("index"))}}else{if(n.indexOf(" - ")>=0){var v=g.trim(w.innerText);var t=n.split(" - ")[0];var u=n.split(" - ")[1];if(f.tool.isDuringDate(v,t,u)){o.push(g(w).parent().data("index"))}}else{if(g.trim(w.innerText).indexOf(n)>=0){o.push(g(w).parent().data("index"))}}}});if(m.length<=0){m=o}else{if(o.length>0){m=f.tool.getSameArray(m,o)}else{m=g.isArray(n)?m:[]}}}return f.tool.uniqueObjArray(m)};f.toLayuiFrom=function(k,i,j){var h=JSON.stringify(f.cache[k]);h=JSON.parse(h);if(j=="checkbox"){layui.each(h[i],function(l,m){h[i+"["+m+"]"]=true});delete h[i]}return h};f.updataTotal=function(h){var i=h.attr("id");e.eachCols(i,function(j,l){if(l.totalRow){var m=0;var k=h.next().find('.layui-table-body td[data-field="'+l.field+'"]');k.each(function(o,p){if(!g(p).parent().hasClass("layui-hide")){m=(m*10+Number(g.trim(p.innerText))*10)/10}});var n=h.next().find('.layui-table-total td[data-field="'+l.field+'"]');n.each(function(o,p){g(p).find(".layui-table-cell").html(m||"0")})}})};f.upNumbers=function(k){var l=k.next().find(".layui-laypage-curr").text();l=Number(l||"1");var i=k.next().find(".layui-laypage-limits select").val();i=Number(i);var h=k.next().find(".layui-table-main tr");var o=l==1?0:i*(l-1);h.each(function(n,p){if(!g(p).hasClass("layui-hide")){o+=1;g(p).find(".laytable-cell-numbers").html(o)}});if(k.next().find(".layui-table-fixed").length>=1){var j=k.next().find(".layui-table-fixed .layui-table-body tr");var m=l==1?0:i*(l-1);j.each(function(n,p){if(!g(p).hasClass("layui-hide")){m+=1;g(p).find(".laytable-cell-numbers").html(m)}})}};f.uncheck=function(j){var k=j.attr("id");var i=j.attr("lay-filter");var h=j.next().find(".layui-table-fixed-l tr");h.each(function(l,m){var n=g(m).find("[name='layTableCheckbox']");if(n.prop("checked")){g(m).find(".layui-form-checked i").click()}})};f.fixAll=function(j){var k=j.attr("id");var i=j.attr("lay-filter");var h=j.next().find(".layui-table-main tr");e.on("checkbox("+i+")",function(m){if(m.type=="all"){var l=e.cache[k];h.each(function(n,o){if(g(o).hasClass("layui-hide")){l[n].LAY_CHECKED=false}})}})};f.hide=function(){g(".layui-table-filter-view").remove()};f.tool={"uniqueObjArray":function(j,m){var l=[];var h=[];if(j.length==0){return j}else{if(m){for(var k=0;k<j.length;k++){if(!h[j[k][m]]){l.push(j[k]);h[j[k][m]]=true}}return l}else{for(var k=0;k<j.length;k++){if(!h[j[k]]){l.push(j[k]);h[j[k]]=true}}return l}}},"getSameArray":function(n,m){var l=[];for(var k=0;k<n.length;k++){for(var h=0;h<m.length;h++){if(m[h]===n[k]){l.push(m[h])}}}return l},"isDuringDate":function(j,l,i){var h=new Date(j),k=new Date(l),m=new Date(i);if(h>=k&&h<=m){return true}return false}};b(a,f)});