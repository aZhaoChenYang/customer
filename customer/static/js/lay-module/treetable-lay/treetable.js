layui.define(["layer","table"],function(a){var e=layui.jquery;var b=layui.layer;var d=layui.table;var c={render:function(f){if(!c.checkParam(f)){return}if(f.data){c.init(f,f.data)}else{e.getJSON(f.url,f.where,function(g){c.init(f,g.data)})}},init:function(n,l){var m=[];var f=n.done;var j=l;for(var h=0;h<j.length;h++){var k=j[h];if(!k.id){if(!n.treeIdName){b.msg("参数treeIdName不能为空",{icon:5});return}k.id=k[n.treeIdName]}if(!k.pid){if(!n.treePidName){b.msg("参数treePidName不能为空",{icon:5});return}k.pid=k[n.treePidName]}}var g=function(p,r){for(var q=0;q<r.length;q++){if(r[q].pid==p){var o=m.length;if(o>0&&m[o-1].id==p){m[o-1].isParent=true}m.push(r[q]);g(r[q].id,r)}}};g(n.treeSpid,j);n.url=undefined;n.data=m;n.page={count:n.data.length,limit:n.data.length};n.cols[0][n.treeColIndex].templet=function(v){var w=v.id;var o=v.pid;var q=v.isParent;var r=c.getEmptyNum(o,m);var p="";for(var s=0;s<r;s++){p+='<span class="treeTable-empty"></span>'}if(q){p+='<i class="layui-icon layui-icon-triangle-d"></i> <i class="layui-icon layui-icon-layer"></i>'}else{p+='<i class="layui-icon layui-icon-file"></i>'}p+="&nbsp;&nbsp;";var u=q?"dir":"file";var t='<span class="treeTable-icon open" lay-tid="'+w+'" lay-tpid="'+o+'" lay-ttype="'+u+'">';return t+p+v[n.cols[0][n.treeColIndex].field]+"</span>"};n.done=function(i,p,o){e(n.elem).next().addClass("treeTable");e(".treeTable .layui-table-page").css("display","none");e(n.elem).next().attr("treeLinkage",n.treeLinkage);if(n.treeDefaultClose){c.foldAll(n.elem)}if(f){f(i,p,o)}};d.render(n)},getEmptyNum:function(g,k){var h=0;if(!g){return h}var f;for(var j=0;j<k.length;j++){if(g==k[j].id){h+=1;f=k[j].pid;break}}return h+c.getEmptyNum(f,k)},toggleRows:function(f,j){var i=f.attr("lay-ttype");if("file"==i){return}var h=f.attr("lay-tid");var g=f.hasClass("open");if(g){f.removeClass("open")}else{f.addClass("open")}f.closest("tbody").find("tr").each(function(){var m=e(this).find(".treeTable-icon");var k=m.attr("lay-tpid");var n=m.attr("lay-ttype");var l=m.hasClass("open");if(h==k){if(g){e(this).hide();if("dir"==n&&l==g){m.trigger("click")}}else{e(this).show();if(j&&"dir"==n&&l==g){m.trigger("click")}}}})},checkParam:function(f){if(!f.treeSpid&&f.treeSpid!=0){b.msg("参数treeSpid不能为空",{icon:5});return false}if(!f.treeColIndex&&f.treeColIndex!=0){b.msg("参数treeColIndex不能为空",{icon:5});return false}return true},expandAll:function(f){e(f).next(".treeTable").find(".layui-table-body tbody tr").each(function(){var h=e(this).find(".treeTable-icon");var i=h.attr("lay-ttype");var g=h.hasClass("open");if("dir"==i&&!g){h.trigger("click")}})},foldAll:function(f){e(f).next(".treeTable").find(".layui-table-body tbody tr").each(function(){var h=e(this).find(".treeTable-icon");var i=h.attr("lay-ttype");var g=h.hasClass("open");if("dir"==i&&g){h.trigger("click")}})}};layui.link(layui.cache.base+"treetable-lay/treetable.css");e("body").on("click",".treeTable .treeTable-icon",function(){var f=e(this).parents(".treeTable").attr("treeLinkage");if("true"==f){c.toggleRows(e(this),true)}else{c.toggleRows(e(this),false)}});a("treetable",c)});