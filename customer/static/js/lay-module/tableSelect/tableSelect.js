layui.define(["table","jquery","form"],function(b){var a="tableSelect",f=layui.jquery,e=layui.table,d=layui.form;var c=function(){this.v="1.1.0"};c.prototype.render=function(h){var i=f(h.elem);var g=h.table.done||function(){};h.searchKey=h.searchKey||"keyword";h.searchPlaceholder=h.searchPlaceholder||"关键词搜索";h.checkedKey=h.checkedKey;h.table.page=h.table.page||true;h.table.height=h.height||315;h.width=h.width||"530";h.searchType=h.searchType||"one";h.searchList=h.searchList||[{key:h.searchKey,placeholder:h.searchPlaceholder}];i.off("click").on("click",function(s){s.stopPropagation();if(f("div.tableSelect").length>=1){return false}var y=i.offset().top+i.outerHeight()+"px";var m=i.offset().left+"px";var x="tableSelect_table_"+new Date().getTime();var u='<div class="tableSelect layui-anim layui-anim-upbit" style="left:'+m+";top:"+y+";border: 1px solid #d2d2d2;background-color: #fff;box-shadow: 0 2px 4px rgba(0,0,0,.12);padding:10px 10px 0 10px;position: absolute;z-index:66666666;margin: 5px 0;border-radius: 2px;min-width:"+h.width+'px;">';u+='<div class="tableSelectBar">';u+='<form class="layui-form" action="" style="display:inline-block;">';if(h.searchType=="more"){f.each(h.searchList,function(l,t){u+='<input style="display:inline-block;width:190px;height:30px;vertical-align:middle;margin-right:-1px;border: 1px solid #C9C9C9;" type="text" name="'+t.searchKey+'" placeholder="'+t.searchPlaceholder+'" autocomplete="off" class="layui-input">'})}else{u+='<input style="display:inline-block;width:190px;height:30px;vertical-align:middle;margin-right:-1px;border: 1px solid #C9C9C9;" type="text" name="'+h.searchKey+'" placeholder="'+h.searchPlaceholder+'" autocomplete="off" class="layui-input">'}u+='<button class="layui-btn layui-btn-sm layui-btn-primary tableSelect_btn_search" lay-submit lay-filter="tableSelect_btn_search"><i class="layui-icon layui-icon-search"></i></button>';u+="</form>";u+='<button style="float:right;" class="layui-btn layui-btn-sm tableSelect_btn_select">选择<span></span></button>';u+="</div>";u+='<table id="'+x+'" lay-filter="'+x+'"></table>';u+="</div>";u=f(u);f("body").append(u);var w=[];h.table.elem="#"+x;h.table.id=x;h.table.done=function(l,z,t){k(l,z,t);q(l,z,t);g(l,z,t)};var r=e.render(h.table);e.on("radio("+x+")",function(l){if(h.checkedKey){w=e.checkStatus(x).data}v(e.checkStatus(x).data.length)});e.on("checkbox("+x+")",function(B){if(h.checkedKey){if(B.checked){for(var z=0;z<e.checkStatus(x).data.length;z++){w.push(e.checkStatus(x).data[z])}}else{if(B.type=="all"){for(var t=0;t<e.cache[x].length;t++){for(var z=0;z<w.length;z++){if(w[z][h.checkedKey]==e.cache[x][t][h.checkedKey]){w.splice(z,1)}}}}else{function l(){var D="";for(var C=0;C<e.cache[x].length;C++){if(!e.cache[x][C].LAY_CHECKED){D=e.cache[x][C][h.checkedKey]}}return D}var A=B.data[h.checkedKey]||l();for(var z=0;z<w.length;z++){if(w[z][h.checkedKey]==A){w.splice(z,1)}}}}w=j(w,h.checkedKey);v(w.length)}else{v(e.checkStatus(x).data.length)}});function q(E,F,C){for(var A=0;A<E.data.length;A++){for(var z=0;z<w.length;z++){if(E.data[A][h.checkedKey]==w[z][h.checkedKey]){E.data[A].LAY_CHECKED=true;var D=E.data[A]["LAY_TABLE_INDEX"];var B=f("#"+x+"").next().find("tr[data-index="+D+'] input[type="checkbox"]');B.prop("checked",true).next().addClass("layui-form-checked");var l=f("#"+x+"").next().find("tr[data-index="+D+'] input[type="radio"]');l.prop("checked",true).next().addClass("layui-form-radioed").find("i").html("&#xe643;")}}}var t=e.checkStatus(x);if(t.isAll){f("#"+x+"").next().find('.layui-table-header th[data-field="0"] input[type="checkbox"]').prop("checked",true);f("#"+x+"").next().find('.layui-table-header th[data-field="0"] input[type="checkbox"]').next().addClass("layui-form-checked")}v(w.length)}function k(z,C,B){if(h.checkedKey&&i.attr("ts-selected")){var A=i.attr("ts-selected").split(",");for(var t=0;t<z.data.length;t++){for(var l=0;l<A.length;l++){if(z.data[t][h.checkedKey]==A[l]){w.push(z.data[t])}}}w=j(w,h.checkedKey)}}function v(l){u.find(".tableSelect_btn_select span").html(l==0?"":"("+l+")")}function j(t,B){var A=[];var l=[];if(t.length==0){return t}else{if(B){for(var z=0;z<t.length;z++){if(!l[t[z][B]]){A.push(t[z]);l[t[z][B]]=true}}return A}else{for(var z=0;z<t.length;z++){if(!l[t[z]]){A.push(t[z]);l[t[z]]=true}}return A}}}var n=(i.offset().top+i.outerHeight()+u.outerHeight()-f(window).scrollTop())>f(window).height();var p=(i.offset().left+u.outerWidth())>f(window).width();n&&u.css({"top":"auto","bottom":"0px"});p&&u.css({"left":"auto","right":"5px"});d.on("submit(tableSelect_btn_search)",function(l){r.reload({where:l.field,page:{curr:1}});return false});e.on("rowDouble("+x+")",function(t){var l={data:[t.data]};o(l)});u.find(".tableSelect_btn_select").on("click",function(){var l=e.checkStatus(x);if(w.length>1){l.data=w}o(l)});function o(z){if(h.checkedKey){var t=[];for(var l=0;l<z.data.length;l++){t.push(z.data[l][h.checkedKey])}i.attr("ts-selected",t.join(","))}h.done(i,z);u.remove();delete e.cache[x];w=[]}f(document).mouseup(function(t){var l=f(""+h.elem+",.tableSelect");if(!l.is(t.target)&&l.has(t.target).length===0){u.remove();delete e.cache[x];w=[]}})})};c.prototype.hide=function(g){f(".tableSelect").remove()};var c=new c();if(window.top==window.self){f(window).scroll(function(){c.hide()})}b(a,c)});